# README: Cell and Nucleus Mask Processing Workflow

This repository contains MATLAB scripts for processing and refining cell and nucleus segmentation masks generated by Cellpose and StarDist. The workflow ensures accurate segmentation by pairing cells with nuclei and removing artifacts or small unwanted objects. Below is an overview of the scripts and their functionalities:

## Script Descriptions

### `clearCellMask.m`
- Removes objects that touch the borders of the image.
- Filters out small objects below a specified area threshold (`thSize`).
- Uses connected component labeling and area-based filtering to retain only valid objects.

### `createMaskNotTouching.m`
- Creates masks of objects that do not touch their neighboring objects.
- Performs erosion using a disk-shaped structuring element and marks retained regions.

### `getOneNucleousPerCell.m`
- Matches nuclei to their corresponding cells, ensuring that each cell has at most one nucleus.
- If multiple nuclei are present in a cell, retains the largest nucleus based on area.
- Filters out nuclei below a specified area threshold (`thSizeNuc`).

### `runall.m`
- The main script that processes all cell and nucleus masks (PNG files) in the specified directory and its subdirectories.
- Steps:
  1. Detects cytoplasm masks (`CellMask`) and nucleus masks (`NucleiMask`) using file names.
  2. Applies the `clearCellMask`, `createMaskNotTouching`, and `getOneNucleousPerCell` functions to refine segmentation.
  3. Saves processed masks in a new folder structure (`processedMasks`) as TIFF files for compatibility and high-quality storage.
  4. Displays a progress bar to track the processing status.

## How to Use
1. Place the scripts in the directory containing the folders with the cell and nucleus masks (PNG files) generated by Cellpose and StarDist.
2. Open MATLAB and navigate to the folder containing the scripts.
3. Run the `runall.m` script by typing `runall` in the MATLAB command window.
4. The processed masks will be saved in a subdirectory named `processedMasks`, replacing the `masks` directory in the file paths.

## Notes
- Ensure the directory contains appropriately named PNG files (`CellMask` for cytoplasm and `NucleiMask` for nuclei) to facilitate file pairing.
- Default parameters for cell size (`cellSize`) and nucleus size (`nucleousSize`) are specified in `runall.m` but can be adjusted as needed.
- This workflow is designed for high-throughput segmentation refinement in fluorescence microscopy images.

